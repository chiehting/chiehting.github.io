<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-G1C48BPHVP"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-G1C48BPHVP")}</script><meta charset=UTF-8><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimal-ui"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=robots content="index, follow"><meta name=author content="Chiehting"><meta name=description content="This website is preview about Chiehting. irregular update."><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><meta name=apple-mobile-web-app-title content="Chiehting's Blog"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Setup FreeIPA client on Ubuntu"><meta itemprop=description content="開發者有需求要連線至 server via ssh, 一般情況下需要在 server 中建立帳號並配置金鑰. 但目前公司的人員管理政策是使用 FreeIPA 做管理, 所以不想要另外在 server 建立帳號, 造成管理複雜.
所以這採用的解決方案是使用 freeipa-client 套件, 讓主機跟 FreeIPA 做人員權限認證."><meta itemprop=datePublished content="2022-01-19T15:43:00+08:00"><meta itemprop=dateModified content="2022-01-19T15:43:00+08:00"><meta itemprop=wordCount content="531"><meta itemprop=keywords content="Freeipa,Ldap"><meta property="og:url" content="https://chiehting.com/posts/freeipa-ssh-with-ldap/"><meta property="og:site_name" content="Chiehting's Blog"><meta property="og:title" content="Setup FreeIPA client on Ubuntu"><meta property="og:description" content="開發者有需求要連線至 server via ssh, 一般情況下需要在 server 中建立帳號並配置金鑰. 但目前公司的人員管理政策是使用 FreeIPA 做管理, 所以不想要另外在 server 建立帳號, 造成管理複雜.
所以這採用的解決方案是使用 freeipa-client 套件, 讓主機跟 FreeIPA 做人員權限認證."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-19T15:43:00+08:00"><meta property="article:modified_time" content="2022-01-19T15:43:00+08:00"><meta property="article:tag" content="Freeipa"><meta property="article:tag" content="Ldap"><meta name=twitter:card content="summary"><meta name=twitter:title content="Setup FreeIPA client on Ubuntu"><meta name=twitter:description content="開發者有需求要連線至 server via ssh, 一般情況下需要在 server 中建立帳號並配置金鑰. 但目前公司的人員管理政策是使用 FreeIPA 做管理, 所以不想要另外在 server 建立帳號, 造成管理複雜.
所以這採用的解決方案是使用 freeipa-client 套件, 讓主機跟 FreeIPA 做人員權限認證."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Setup FreeIPA client on Ubuntu","name":"Setup FreeIPA client on Ubuntu","description":"開發者有需求要連線至 server via ssh, 一般情況下需要在 server 中建立帳號並配置金鑰. 但目前公司的人員管理政策是使用 FreeIPA 做管理, 所以不想要另外在 server 建立帳號, 造成管理複雜.\n所以這採用的解決方案是使用 freeipa-client 套件, 讓主機跟 FreeIPA 做人員權限認證.\n","keywords":["freeipa","ldap"],"articleBody":"開發者有需求要連線至 server via ssh, 一般情況下需要在 server 中建立帳號並配置金鑰. 但目前公司的人員管理政策是使用 FreeIPA 做管理, 所以不想要另外在 server 建立帳號, 造成管理複雜.\n所以這採用的解決方案是使用 freeipa-client 套件, 讓主機跟 FreeIPA 做人員權限認證.\nInstall FreeIPA client package server OS is Ubuntu 20.04.\n在開始前, 先更新主機套件, 讓軟體升級到最新.\nroot@edge:/root# apt-get update root@edge:/root# apt-get upgrade 確認防火牆是否有開通, 規則如下.\nPlease make sure the following ports are opened in the firewall settings: TCP: 80, 88, 389 UDP: 88 (at least one of TCP/UDP ports 88 has to be open) Also note that following ports are necessary for ipa-client working properly after enrollment: TCP: 464 UDP: 464, 123 (if NTP enabled) 安裝 \u0026 配置 freeipa-client 套件.\nroot@edge:/root# apt-get install -y freeipa-client root@edge:/root# ipa-client-install --hostname=`hostname -f` --mkhomedir --server=ldap.example.com --domain example.com --realm EXAMPLE.COM WARNING: conflicting time\u0026date synchronization service 'ntp' will be disabled in favor of chronyd Autodiscovery of servers for failover cannot work with this configuration. If you proceed with the installation, services will be configured to always access the discovered server for all operations and will not fail over to other servers in case of failure. Proceed with fixed values and no DNS discovery? [no]: yes Client hostname: edge.example.com Realm: EXAMPLE.COM DNS Domain: example.com IPA Server: ldap.example.com BaseDN: dc=example,dc=com Continue to configure the system with these values? [no]: yes Synchronizing time No SRV records of NTP servers found and no NTP server or pool address was provided. Using default chrony configuration. Attempting to sync time with chronyc. Time synchronization was successful. User authorized to enroll computers: admin Password for admin@EXAMPLE.COM: ・・・ The ipa-client-install command was successful Setup policy 安裝完成後, 登入 FreeIPA website 在 Host 可以看到已經有新增剛剛那台主機.\n接著到 Policy 裡面配置 HBAC Rules, 建議 disable allow_all 關閉預設允許全部用戶訪問. 再來新增一個權限 allow_edge, 預計讓開發可以進入到邊緣節點.\n接著配置 HBAC, “Who” 可以操作哪些 “Accessing” 的 “Service”, 以下圖的範例為：\nbackend group 可以操作 edge.example.com 的 login backend group 可以操作 edge.example.com 的 sshd admins group 可以操作 edge.example.com 的 login admins group 可以操作 edge.example.com 的 sshd 完成後可測試 ssh login, 看使否可以登入\nReferences how to configure freeipa client on ubuntu centos ","wordCount":"531","inLanguage":"en","datePublished":"2022-01-19T15:43:00+08:00","dateModified":"2022-01-19T15:43:00+08:00","author":{"@type":"Person","name":"Chiehting"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://chiehting.com/posts/freeipa-ssh-with-ldap/"},"publisher":{"@type":"Organization","name":"Chiehting's Blog","description":"This website is preview about Chiehting. irregular update.","logo":{"@type":"ImageObject","url":"https://chiehting.com/favicon.ico"}}}</script><title>Setup FreeIPA client on Ubuntu</title><link rel="stylesheet dns-prefetch preconnect preload prefetch" as=style media=screen href=https://chiehting.com/css/style.min.4a728eca217aff37d24d94ea492de99e69fea0a53bb05c836db76b9d0504ef60.css integrity="sha256-SnKOyiF6/zfSTZTqSS3pnmn+oKU7sFyDbbdrnQUE72A=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://chiehting.com/>Chiehting's Blog</a></div><nav class="site-nav hide-in-mobile"><a href=https://chiehting.com/posts/>Posts</a><a href=https://chiehting.com/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-links hide-in-mobile"><a href=ting911111@gmail.com target=_blank rel="noopener me" title=Email><svg class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=https://github.com/chiehting target=_blank rel="noopener me" title=Github><svg class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://chiehting.com/posts/>Posts</a></li><li><a href=https://chiehting.com/about/>About</a></li></ul></div><main class="site-main section-inner thin animated fadeIn faster"><h1>Setup FreeIPA client on Ubuntu</h1><div class=content><p>開發者有需求要連線至 server via ssh, 一般情況下需要在 server 中建立帳號並配置金鑰.
但目前公司的人員管理政策是使用 FreeIPA 做管理, 所以不想要另外在 server 建立帳號, 造成管理複雜.</p><p>所以這採用的解決方案是使用 freeipa-client 套件, 讓主機跟 FreeIPA 做人員權限認證.</p><h3 id=install-freeipa-client-package>Install FreeIPA client package<a href=#install-freeipa-client-package class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>server OS is Ubuntu 20.04.</p><p>在開始前, 先更新主機套件, 讓軟體升級到最新.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@edge:/root# apt-get update
</span></span><span class=line><span class=cl>root@edge:/root# apt-get upgrade
</span></span></code></pre></div><p>確認防火牆是否有開通, 規則如下.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>Please make sure the following ports are opened in the firewall settings:
</span></span><span class=line><span class=cl>TCP: 80, 88, 389
</span></span><span class=line><span class=cl>UDP: 88 (at least one of TCP/UDP ports 88 has to be open)
</span></span><span class=line><span class=cl>Also note that following ports are necessary for ipa-client working
</span></span><span class=line><span class=cl>properly after enrollment:
</span></span><span class=line><span class=cl>TCP: 464
</span></span><span class=line><span class=cl>UDP: 464, 123 (if NTP enabled)
</span></span></code></pre></div><p>安裝 & 配置 freeipa-client 套件.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@edge:/root# apt-get install -y freeipa-client
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@edge:/root# ipa-client-install --hostname<span class=o>=</span><span class=sb>`</span>hostname -f<span class=sb>`</span> --mkhomedir --server<span class=o>=</span>ldap.example.com --domain example.com --realm EXAMPLE.COM
</span></span><span class=line><span class=cl>WARNING: conflicting time<span class=p>&amp;</span>date synchronization service <span class=s1>&#39;ntp&#39;</span> will be disabled
</span></span><span class=line><span class=cl>in favor of chronyd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Autodiscovery of servers <span class=k>for</span> failover cannot work with this configuration.
</span></span><span class=line><span class=cl>If you proceed with the installation, services will be configured to always access the discovered server <span class=k>for</span> all operations and will not fail over to other servers in <span class=k>case</span> of failure.
</span></span><span class=line><span class=cl>Proceed with fixed values and no DNS discovery? <span class=o>[</span>no<span class=o>]</span>: yes
</span></span><span class=line><span class=cl>Client hostname: edge.example.com
</span></span><span class=line><span class=cl>Realm: EXAMPLE.COM
</span></span><span class=line><span class=cl>DNS Domain: example.com
</span></span><span class=line><span class=cl>IPA Server: ldap.example.com
</span></span><span class=line><span class=cl>BaseDN: <span class=nv>dc</span><span class=o>=</span>example,dc<span class=o>=</span>com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Continue to configure the system with these values? <span class=o>[</span>no<span class=o>]</span>: yes
</span></span><span class=line><span class=cl>Synchronizing <span class=nb>time</span>
</span></span><span class=line><span class=cl>No SRV records of NTP servers found and no NTP server or pool address was provided.
</span></span><span class=line><span class=cl>Using default chrony configuration.
</span></span><span class=line><span class=cl>Attempting to sync <span class=nb>time</span> with chronyc.
</span></span><span class=line><span class=cl>Time synchronization was successful.
</span></span><span class=line><span class=cl>User authorized to enroll computers: admin
</span></span><span class=line><span class=cl>Password <span class=k>for</span> admin@EXAMPLE.COM:
</span></span><span class=line><span class=cl>・・・
</span></span><span class=line><span class=cl>The ipa-client-install <span class=nb>command</span> was successful
</span></span></code></pre></div><h3 id=setup-policy>Setup policy<a href=#setup-policy class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>安裝完成後, 登入 FreeIPA website 在 Host 可以看到已經有新增剛剛那台主機.</p><p><img src=https://storage.googleapis.com/chiehting.com/blog/2022-01-19-install-freeipa-client-on-ubuntu-1.png alt=hosts></p><p>接著到 Policy 裡面配置 HBAC Rules, 建議 disable allow_all 關閉預設允許全部用戶訪問.
再來新增一個權限 <code>allow_edge</code>, 預計讓開發可以進入到邊緣節點.</p><p><img src=https://storage.googleapis.com/chiehting.com/blog/2022-01-19-install-freeipa-client-on-ubuntu-2.png alt=hbac-rules></p><p>接著配置 HBAC, &ldquo;Who&rdquo; 可以操作哪些 &ldquo;Accessing&rdquo; 的 &ldquo;Service&rdquo;, 以下圖的範例為：</p><ol><li>backend group 可以操作 edge.example.com 的 login</li><li>backend group 可以操作 edge.example.com 的 sshd</li><li>admins group 可以操作 edge.example.com 的 login</li><li>admins group 可以操作 edge.example.com 的 sshd</li></ol><p><img src=https://storage.googleapis.com/chiehting.com/blog/2022-01-19-install-freeipa-client-on-ubuntu-3.png alt=policys></p><p>完成後可測試 ssh login, 看使否可以登入</p><h3 id=references>References<a href=#references class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><ol><li><a href=https://computingforgeeks.com/how-to-configure-freeipa-client-on-ubuntu-centos/>how to configure freeipa client on ubuntu centos</a></li></ol></div><div class="human single"><a href=https://brainmade.org/ target=_blank rel="external noreferrer noopener"><abbr title="I don't hate AIs; but I love humans!"><svg fill="#fff" width="128" height="40" viewBox="0 0 128 40"><path d="M26.306 39.391H11.665a1.28 1.28.0 01-1.28-1.28v-3.838H6.399a1.28 1.28.0 01-1.28-1.28v-5.336l-4.41-2.198a1.28 1.28.0 01-.493-1.855l4.904-7.357v-2.175C5.12 6.298 11.422.0 19.194.0s14.073 6.3 14.075 14.071c-.316 13.912-5.38 11.758-5.59 17.023l-.093 7.018a1.3 1.3.0 01-.375.905 1.27 1.27.0 01-.905.375zm-13.361-2.559h12.082l.143-7.27c-.132-3.329 5.858-4.122 5.54-15.368-.179-6.356-5.157-11.635-11.515-11.635S7.68 7.713 7.679 14.071v2.559c-.001.253-.075.5-.215.71l-4.315 6.471 3.822 1.91a1.28 1.28.0 01.708 1.145v4.848h3.987a1.28 1.28.0 011.28 1.28z"/><path d="M20.186 29.111v-9.644c.059.0.118.009.177.009 4.885-.006 8.525-4.506 7.511-9.284a1.19 1.19.0 00-.911-.911 7.67 7.67.0 00-9.049 5.67l-.033-.036a7.66 7.66.0 00-7.03-2.085 1.19 1.19.0 00-.911.91c-1.014 4.777 2.627 9.277 7.51 9.284.118.0.246-.014.369-.02v6.106zm1.419-16.072a5.33 5.33.0 014.062-1.553 5.33 5.33.0 01-5.614 5.615 5.3 5.3.0 011.552-4.061zm-7.904 6.057a5.3 5.3.0 01-1.559-4.061 5.323 5.323.0 015.614 5.615 5.3 5.3.0 01-4.055-1.554m38.419-6.79q0 2.346-1.567 3.63-1.567 1.282-4.351 1.283h-7.669V0h7.016q2.807.0 4.242 1.1 1.446 1.087 1.446 3.226.0 1.467-.729 2.481-.718 1.002-2.197 1.357 1.86.244 2.828 1.32.979 1.063.979 2.823zm-4.112-7.491q0-1.161-.663-1.65-.652-.488-1.947-.488h-3.655v4.265h3.677q1.36.0 1.968-.525.62-.537.62-1.601m.892 7.209q0-2.42-3.089-2.42h-4.069v4.938h4.188q1.545.0 2.252-.624.718-.635.718-1.894m16.26 5.194-3.557-6.538h-3.764v6.538H54.63V0h7.658q2.741.0 4.231 1.332 1.49 1.32 1.49 3.8.0 1.808-.913 3.128-.914 1.308-2.47 1.723l4.144 7.235zm-.381-11.94q0-2.481-2.828-2.481h-4.112v5.083h4.199q1.349.0 2.045-.684.696-.685.696-1.919m16.785 11.94-1.36-4.399h-5.841l-1.359 4.399h-3.209L75.386.0h3.785l5.569 17.219zM77.278 2.651l-.066.269q-.109.44-.261 1.002c-.152.563-.725 2.436-1.871 6.184h4.405l-1.512-4.949-.468-1.662zm9.551 14.567V0h3.209v17.219zm15.53.0L95.681 3.959q.196 1.931.196 3.104v10.155h-2.849V0h3.666l6.777 13.37q-.196-1.846-.196-3.361V0h2.85v17.219zM52.63 39.375V28.331q.011-.351.115-3.015-.818 3.257-1.209 4.541l-2.925 9.518h-2.418l-2.925-9.518-1.232-4.541q.139 2.809.139 3.717v10.342h-3.017V22.313h4.548l2.902 9.543.253.92.553 2.289.725-2.736 2.983-10.015h4.526v17.063zm17.64.0-1.44-4.359h-6.184l-1.44 4.359h-3.397l5.919-17.063h4.007l5.896 17.063zm-4.537-14.434-.069.267q-.115.436-.277.993c-.162.557-.767 2.414-1.98 6.128h4.663l-1.601-4.905-.495-1.647zm24.577 5.776q0 2.64-.99 4.614-.979 1.961-2.787 3.003-1.796 1.042-4.122 1.042h-6.564V22.313h5.873q4.099.0 6.345 2.18 2.245 2.167 2.245 6.224m-3.42.0q0-2.748-1.359-4.19-1.359-1.453-3.881-1.453h-2.407v11.54h2.879q2.188.0 3.478-1.586t1.29-4.311m6 8.659V22.313h12.759v2.761h-9.362v4.287h8.66v2.761h-8.66v4.492h9.835v2.761zm15.75.0v-3.693h3.328v3.693zm12.445-12.149q2.082.0 3.662.781 1.58.78 2.422 2.235.833 1.454.833 3.393.0 2.98-1.845 4.676Q124.302 40 121.085 40q-3.208.0-5.005-1.688-1.798-1.688-1.798-4.695c0-3.007.606-3.57 1.817-4.694q1.817-1.696 4.986-1.696m0 2.702q-2.157.0-3.378.97-1.23.97-1.23 2.72.0 1.777 1.22 2.747 1.211.97 3.388.97 2.195.0 3.462-.988 1.258-.997 1.258-2.711.0-1.778-1.23-2.738-1.23-.97-3.491-.97m6.725-13.402-5.062 2.935v3.107h5.062v2.648h-13.331v-6.322q0-2.261 1.031-3.491 1.022-1.23 2.942-1.23 1.4.0 2.422.754 1.012.754 1.334 2.038l5.601-3.42zm-9.244.314q-1.92.0-1.921 2.334v3.393h3.936v-3.465q0-1.113-.53-1.688t-1.486-.575m7.249-10.915a6.5 6.5.0 00-.313-2.002q-.321-.969-.814-1.499h-1.845v3.088h-2.063V0h4.901q1.088 1.005 1.703 2.622a9.4 9.4.0 01.615 3.375q0 3.088-1.798 4.748-1.808 1.661-5.119 1.661-3.292.0-5.043-1.67-1.76-1.67-1.76-4.803.0-4.452 3.473-5.664l.776 2.442q-1.012.395-1.533 1.238-.52.844-.52 1.984.0 1.867 1.192 2.837t3.416.97q2.261.0 3.501-.997 1.23-1.005 1.23-2.818z"/></svg></abbr></a></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2026 <a href=https://chiehting.com/>Chiehting's Blog</a>
&#183; Copyright © 2025 Chiehting Lee. All rights reserved.</p></footer><script async src=https://chiehting.com/js/bundle.min.217d62397cbef6f9f5d8bab30d7e7969d78c52a436ca5d5790cef4d6fef3f1f2.js integrity="sha256-IX1iOXy+9vn12LqzDX55adeMUqQ2yl1XkM701v7z8fI=" crossorigin=anonymous></script><script async src=https://chiehting.com/js/link-share.min.24409a4f6e5537d70ffc55ec8f9192208d718678cb8638585342423020b37f39.js integrity="sha256-JECaT25VN9cP/FXsj5GSII1xhnjLhjhYU0JCMCCzfzk=" crossorigin=anonymous></script></body></html>