<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-G1C48BPHVP"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-G1C48BPHVP")}</script><meta charset=UTF-8><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimal-ui"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=robots content="index, follow"><meta name=author content><meta name=description content="This website is preview about Chiehting. irregular update."><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><meta name=apple-mobile-web-app-title content="Chiehting's Blog"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Uber's Golang code style guide"><meta itemprop=description content="學習 Uber 在 Golang 上的規範。 這裡做個筆記，主要還是去原文裡面看會比較詳細。"><meta itemprop=datePublished content="2021-08-12T10:58:00+08:00"><meta itemprop=dateModified content="2021-08-12T10:58:00+08:00"><meta itemprop=wordCount content="1057"><meta itemprop=keywords content="Golang"><meta property="og:url" content="https://chiehting.com/posts/golang-code-style-on-uber/"><meta property="og:site_name" content="Chiehting's Blog"><meta property="og:title" content="Uber's Golang code style guide"><meta property="og:description" content="學習 Uber 在 Golang 上的規範。 這裡做個筆記，主要還是去原文裡面看會比較詳細。"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-12T10:58:00+08:00"><meta property="article:modified_time" content="2021-08-12T10:58:00+08:00"><meta property="article:tag" content="Golang"><meta name=twitter:card content="summary"><meta name=twitter:title content="Uber's Golang code style guide"><meta name=twitter:description content="學習 Uber 在 Golang 上的規範。 這裡做個筆記，主要還是去原文裡面看會比較詳細。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Uber's Golang code style guide","name":"Uber\u0027s Golang code style guide","description":"學習 Uber 在 Golang 上的規範。 這裡做個筆記，主要還是去原文裡面看會比較詳細。\n","keywords":["golang"],"articleBody":"學習 Uber 在 Golang 上的規範。 這裡做個筆記，主要還是去原文裡面看會比較詳細。\nReferances uber style guide。\nTable of Contents Uber 的 style guild 目錄列表中，看到 Uber style 的幾個大指標。\nIntroduction Guidelines Performance Style Patterns Linting Introduction 在 Uber 的規範中，大部分使用了 Go 的一般標準，如下\nEffective Go Go Common Mistakes Go Code Review Comments 所有程式碼都必須透過 golint 和 go vet 來檢查是否有問題。也最好將其設定在編輯工具中。\nRun goimports -w . on save Run golint ./... and go vet to check for errors Guidelines Pointers to Interfaces 通常會包括兩個欄位：\n指標類型資訊 資料指標，須以地址放入. 如果資料是一個記憶體位置則直接放入，如果是一個值則使用這個值的記憶體位置放入。 Start Enums at One 在使用常數與 iota 時， 建議起始值為 1。 關於這點，我有碰過相關的坑，例如 gorm update 預設只會更新非零的值。\nupdating with struct it will only update non-zero fields by default\ntype Operation int const ( Add Operation = iota + 1 Subtract Multiply ) 但是在特定情況下，0 具有代表意義的話，則使用 0。 例如：\ntype LogOutput int const ( LogToStdout LogOutput = iota LogToFile LogToRemote ) // LogToStdout=0, LogToFile=1, LogToRemote=2 Use “time” to handle time 時間會被假定錯誤，例如：\nA day has 24 hours An hour has 60 minutes A week has 7 days A year has 365 days 以第一條為來說，加入 24 小時不一定會隔天。在做時間處理時使用 time package 可以確保安全。\nfunc isActive(now, start, stop int) bool { return start \u003c= now \u0026\u0026 now \u003c stop } func isActive(now, start, stop time.Time) bool { return (start.Before(now) || start.Equal(now)) \u0026\u0026 now.Before(stop) } Error Types you should use a custom type, and implement the Error() method.\n// package foo var ErrCouldNotOpen = errors.New(\"could not open\") func Open() error { return ErrCouldNotOpen } // package bar if err := foo.Open(); err != nil { if errors.Is(err, foo.ErrCouldNotOpen) { // handle } else { panic(\"unknown error\") } } Avoid Mutable Globals 勁量避免在全域變數中定義可變的變數，例如 var _timeNow = time.Now。\nAvoid Using Built-In Names 不要使用容易令人混淆的關鍵字，例如 var error string。\nPerformance Prefer strconv over fmt 字串轉換使用 strconv 代替 fmt，約提高 55% 的效能。\nPrefer Specifying Container Capacity 在使用 make 函式時，使用 length、capacity 參數，約提高 91% 的效能。\nmake([]T, length, capacity) Style Group Similar Declarations 將同屬性相關的變數，用群組做分類例如：\nimport ( \"a\" \"b\" ) const ( a = 1 b = 2 ) var ( a = 1 b = 2 ) type ( Area float64 Volume float64 ) 如果變數屬不相關的，明確分開。\nImport Group Ordering There should be two import groups:\nStandard library Everything else import ( \"fmt\" \"os\" \"go.uber.org/atomic\" \"golang.org/x/sync/errgroup\" ) Package Names 要命名 package 時，採用下面規範：\n全部小寫，也沒字母大寫跟底線 名稱定義清楚，使引用 package 時不用重新命名 名稱短而簡潔，但要有明確的識別度 不使用負數，例如 net/url，而不是 net/urls 別使用 “common”, “util”, “shared”, or “lib”。這名稱沒有有用的資訊 See also Package Names and Style guideline for Go packages.\nFunction Grouping and Ordering function 必須放置在全域定義 struct, const, var 之後。 並且做分群分類。\nReduce Nesting if、for 減少槽狀式的寫法\nUnnecessary Else 不用 else 就別硬用\nvar a int if b { a = 100 } else { a = 10 } a := 10 if b { a = 100 } Prefix Unexported Globals with _ 在全域 var 和 const 變數加上前綴 _，在使用時可以明確的知道該變數是全域變數。 例外: 如果是 error 的變數，前綴應該使用 err。\nUse Raw String Literals to Avoid Escaping wantError := `unknown error:\"test\"` Initializing Maps Prefer make(..) for empty maps, and maps populated programmatically. This makes map initialization visually distinct from declaration, and it makes it easy to add size hints later if available.\nvar ( // m1 is safe to read and write; // m2 will panic on writes. m1 = make(map[T1]T2) m2 map[T1]T2 ) ","wordCount":"1057","inLanguage":"en","datePublished":"2021-08-12T10:58:00+08:00","dateModified":"2021-08-12T10:58:00+08:00","author":{"@type":"Person","name":null},"mainEntityOfPage":{"@type":"WebPage","@id":"https://chiehting.com/posts/golang-code-style-on-uber/"},"publisher":{"@type":"Organization","name":"Chiehting's Blog","description":"This website is preview about Chiehting. irregular update.","logo":{"@type":"ImageObject","url":"https://chiehting.com/favicon.ico"}}}</script><title>Uber's Golang code style guide</title><link rel="stylesheet dns-prefetch preconnect preload prefetch" as=style media=screen href=https://chiehting.com/css/style.min.4a728eca217aff37d24d94ea492de99e69fea0a53bb05c836db76b9d0504ef60.css integrity="sha256-SnKOyiF6/zfSTZTqSS3pnmn+oKU7sFyDbbdrnQUE72A=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://chiehting.com/>Chiehting's Blog</a></div><nav class="site-nav hide-in-mobile"><a href=https://chiehting.com/posts/>Posts</a><a href=https://chiehting.com/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-links hide-in-mobile"><a href=ting911111@gmail.com target=_blank rel="noopener me" title=Email><svg class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=https://github.com/chiehting target=_blank rel="noopener me" title=Github><svg class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://chiehting.com/posts/>Posts</a></li><li><a href=https://chiehting.com/about/>About</a></li></ul></div><main class="site-main section-inner thin animated fadeIn faster"><h1>Uber's Golang code style guide</h1><div class=content><p>學習 Uber 在 Golang 上的規範。
這裡做個筆記，主要還是去原文裡面看會比較詳細。</p><h3 id=referances>Referances<a href=#referances class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p><a href=https://github.com/uber-go/guide/blob/master/style.md>uber style guide</a>。</p><h3 id=table-of-contents>Table of Contents<a href=#table-of-contents class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>Uber 的 style guild 目錄列表中，看到 Uber style 的幾個大指標。</p><ul><li>Introduction</li><li>Guidelines</li><li>Performance</li><li>Style</li><li>Patterns</li><li>Linting</li></ul><h3 id=introduction>Introduction<a href=#introduction class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>在 Uber 的規範中，大部分使用了 Go 的一般標準，如下</p><ol><li><a href=https://golang.org/doc/effective_go.html>Effective Go</a></li><li><a href=https://github.com/golang/go/wiki/CommonMistakes>Go Common Mistakes</a></li><li><a href=https://github.com/golang/go/wiki/CodeReviewComments>Go Code Review Comments</a></li></ol><p>所有程式碼都必須透過 golint 和 go vet 來檢查是否有問題。也最好將其設定在編輯工具中。</p><ul><li>Run <code>goimports -w .</code> on save</li><li>Run <code>golint ./...</code> and <code>go vet</code> to check for errors</li></ul><h3 id=guidelines>Guidelines<a href=#guidelines class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><h4 id=pointers-to-interfaces>Pointers to Interfaces<a href=#pointers-to-interfaces class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>通常會包括兩個欄位：</p><ol><li>指標類型資訊</li><li>資料指標，須以地址放入. 如果資料是一個記憶體位置則直接放入，如果是一個值則使用這個值的記憶體位置放入。</li></ol><h4 id=start-enums-at-one>Start Enums at One<a href=#start-enums-at-one class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>在使用常數與 iota 時， 建議起始值為 1。
關於這點，我有碰過相關的坑，例如 <a href=https://gorm.io/docs/update.html#Updates-multiple-columns>gorm update</a> 預設只會更新非零的值。</p><blockquote><p>updating with struct it will only update non-zero fields by default</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Operation</span><span class=w> </span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>Add</span><span class=w> </span><span class=nx>Operation</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>iota</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>Subtract</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>Multiply</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>但是在特定情況下，0 具有代表意義的話，則使用 0。 例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>LogOutput</span><span class=w> </span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>LogToStdout</span><span class=w> </span><span class=nx>LogOutput</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>iota</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>LogToFile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>LogToRemote</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// LogToStdout=0, LogToFile=1, LogToRemote=2</span><span class=w>
</span></span></span></code></pre></div><h4 id=use-time-to-handle-time>Use &ldquo;time&rdquo; to handle time<a href=#use-time-to-handle-time class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>時間會被假定錯誤，<a href=https://infiniteundo.com/post/25326999628/falsehoods-programmers-believe-about-time>例如</a>：</p><ul><li>A day has 24 hours</li><li>An hour has 60 minutes</li><li>A week has 7 days</li><li>A year has 365 days</li></ul><p>以第一條為來說，加入 24 小時不一定會隔天。在做時間處理時使用 <code>time</code> package 可以確保安全。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>isActive</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span><span class=w> </span><span class=nx>start</span><span class=p>,</span><span class=w> </span><span class=nx>stop</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>start</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=nx>now</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>now</span><span class=w> </span><span class=p>&lt;</span><span class=w> </span><span class=nx>stop</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>isActive</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span><span class=w> </span><span class=nx>start</span><span class=p>,</span><span class=w> </span><span class=nx>stop</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=nx>start</span><span class=p>.</span><span class=nf>Before</span><span class=p>(</span><span class=nx>now</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>start</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>now</span><span class=p>))</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>now</span><span class=p>.</span><span class=nf>Before</span><span class=p>(</span><span class=nx>stop</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 id=error-types>Error Types<a href=#error-types class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>you should use a custom type, and implement the Error() method.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// package foo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>ErrCouldNotOpen</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;could not open&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>Open</span><span class=p>()</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>ErrCouldNotOpen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// package bar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>foo</span><span class=p>.</span><span class=nf>Open</span><span class=p>();</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nf>Is</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>foo</span><span class=p>.</span><span class=nx>ErrCouldNotOpen</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// handle</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>panic</span><span class=p>(</span><span class=s>&#34;unknown error&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 id=avoid-mutable-globals>Avoid Mutable Globals<a href=#avoid-mutable-globals class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>勁量避免在全域變數中定義可變的變數，例如 <code>var _timeNow = time.Now</code>。</p><h4 id=avoid-using-built-in-names>Avoid Using Built-In Names<a href=#avoid-using-built-in-names class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>不要使用容易令人混淆的關鍵字，例如 <code>var error string</code>。</p><h3 id=performance>Performance<a href=#performance class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><h4 id=prefer-strconv-over-fmt>Prefer strconv over fmt<a href=#prefer-strconv-over-fmt class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>字串轉換使用 <code>strconv</code> 代替 <code>fmt</code>，約提高 55% 的效能。</p><h4 id=prefer-specifying-container-capacity>Prefer Specifying Container Capacity<a href=#prefer-specifying-container-capacity class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>在使用 make 函式時，使用 <code>length</code>、<code>capacity</code> 參數，約提高 91% 的效能。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nb>make</span><span class=p>([]</span><span class=nx>T</span><span class=p>,</span><span class=w> </span><span class=nx>length</span><span class=p>,</span><span class=w> </span><span class=nx>capacity</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h3 id=style>Style<a href=#style class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><h4 id=group-similar-declarations>Group Similar Declarations<a href=#group-similar-declarations class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>將同屬性相關的變數，用群組做分類例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;a&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;b&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>a</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>b</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>a</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>b</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>Area</span><span class=w> </span><span class=kt>float64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>Volume</span><span class=w> </span><span class=kt>float64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>如果變數屬不相關的，明確分開。</p><h4 id=import-group-ordering>Import Group Ordering<a href=#import-group-ordering class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>There should be two import groups:</p><ul><li>Standard library</li><li>Everything else</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;fmt&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;os&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;go.uber.org/atomic&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;golang.org/x/sync/errgroup&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h4 id=package-names>Package Names<a href=#package-names class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>要命名 package 時，採用下面規範：</p><ul><li>全部小寫，也沒字母大寫跟底線</li><li>名稱定義清楚，使引用 package 時不用重新命名</li><li>名稱短而簡潔，但要有明確的識別度</li><li>不使用負數，例如 <code>net/url</code>，而不是 <code>net/urls</code></li><li>別使用 &ldquo;common&rdquo;, &ldquo;util&rdquo;, &ldquo;shared&rdquo;, or &ldquo;lib&rdquo;。這名稱沒有有用的資訊</li></ul><p>See also <a href=https://blog.golang.org/package-names>Package Names</a> and <a href=https://rakyll.org/style-packages/>Style guideline for Go packages</a>.</p><h4 id=function-grouping-and-ordering>Function Grouping and Ordering<a href=#function-grouping-and-ordering class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>function 必須放置在全域定義 struct, const, var 之後。
並且做分群分類。</p><h4 id=reduce-nesting>Reduce Nesting<a href=#reduce-nesting class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>if、for 減少槽狀式的寫法</p><h4 id=unnecessary-else>Unnecessary Else<a href=#unnecessary-else class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>不用 else 就別硬用</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=nx>b</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>a</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>a</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>a</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=mi>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=nx>b</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>a</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 id=prefix-unexported-globals-with-_>Prefix Unexported Globals with _<a href=#prefix-unexported-globals-with-_ class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>在全域 var 和 const 變數加上前綴 <code>_</code>，在使用時可以明確的知道該變數是全域變數。
例外: 如果是 error 的變數，前綴應該使用 <code>err</code>。</p><h4 id=use-raw-string-literals-to-avoid-escaping>Use Raw String Literals to Avoid Escaping<a href=#use-raw-string-literals-to-avoid-escaping class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>wantError</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>`unknown error:&#34;test&#34;`</span><span class=w>
</span></span></span></code></pre></div><h4 id=initializing-maps>Initializing Maps<a href=#initializing-maps class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>Prefer make(..) for empty maps, and maps populated programmatically. This makes map initialization visually distinct from declaration, and it makes it easy to add size hints later if available.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// m1 is safe to read and write;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// m2 will panic on writes.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>m1</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=nx>T1</span><span class=p>]</span><span class=nx>T2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>m2</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=nx>T1</span><span class=p>]</span><span class=nx>T2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div></div><div class="human single"><a href=https://brainmade.org/ target=_blank rel="external noreferrer noopener"><abbr title="I don't hate AIs; but I love humans!"><svg fill="#fff" width="128" height="40" viewBox="0 0 128 40"><path d="M26.306 39.391H11.665a1.28 1.28.0 01-1.28-1.28v-3.838H6.399a1.28 1.28.0 01-1.28-1.28v-5.336l-4.41-2.198a1.28 1.28.0 01-.493-1.855l4.904-7.357v-2.175C5.12 6.298 11.422.0 19.194.0s14.073 6.3 14.075 14.071c-.316 13.912-5.38 11.758-5.59 17.023l-.093 7.018a1.3 1.3.0 01-.375.905 1.27 1.27.0 01-.905.375zm-13.361-2.559h12.082l.143-7.27c-.132-3.329 5.858-4.122 5.54-15.368-.179-6.356-5.157-11.635-11.515-11.635S7.68 7.713 7.679 14.071v2.559c-.001.253-.075.5-.215.71l-4.315 6.471 3.822 1.91a1.28 1.28.0 01.708 1.145v4.848h3.987a1.28 1.28.0 011.28 1.28z"/><path d="M20.186 29.111v-9.644c.059.0.118.009.177.009 4.885-.006 8.525-4.506 7.511-9.284a1.19 1.19.0 00-.911-.911 7.67 7.67.0 00-9.049 5.67l-.033-.036a7.66 7.66.0 00-7.03-2.085 1.19 1.19.0 00-.911.91c-1.014 4.777 2.627 9.277 7.51 9.284.118.0.246-.014.369-.02v6.106zm1.419-16.072a5.33 5.33.0 014.062-1.553 5.33 5.33.0 01-5.614 5.615 5.3 5.3.0 011.552-4.061zm-7.904 6.057a5.3 5.3.0 01-1.559-4.061 5.323 5.323.0 015.614 5.615 5.3 5.3.0 01-4.055-1.554m38.419-6.79q0 2.346-1.567 3.63-1.567 1.282-4.351 1.283h-7.669V0h7.016q2.807.0 4.242 1.1 1.446 1.087 1.446 3.226.0 1.467-.729 2.481-.718 1.002-2.197 1.357 1.86.244 2.828 1.32.979 1.063.979 2.823zm-4.112-7.491q0-1.161-.663-1.65-.652-.488-1.947-.488h-3.655v4.265h3.677q1.36.0 1.968-.525.62-.537.62-1.601m.892 7.209q0-2.42-3.089-2.42h-4.069v4.938h4.188q1.545.0 2.252-.624.718-.635.718-1.894m16.26 5.194-3.557-6.538h-3.764v6.538H54.63V0h7.658q2.741.0 4.231 1.332 1.49 1.32 1.49 3.8.0 1.808-.913 3.128-.914 1.308-2.47 1.723l4.144 7.235zm-.381-11.94q0-2.481-2.828-2.481h-4.112v5.083h4.199q1.349.0 2.045-.684.696-.685.696-1.919m16.785 11.94-1.36-4.399h-5.841l-1.359 4.399h-3.209L75.386.0h3.785l5.569 17.219zM77.278 2.651l-.066.269q-.109.44-.261 1.002c-.152.563-.725 2.436-1.871 6.184h4.405l-1.512-4.949-.468-1.662zm9.551 14.567V0h3.209v17.219zm15.53.0L95.681 3.959q.196 1.931.196 3.104v10.155h-2.849V0h3.666l6.777 13.37q-.196-1.846-.196-3.361V0h2.85v17.219zM52.63 39.375V28.331q.011-.351.115-3.015-.818 3.257-1.209 4.541l-2.925 9.518h-2.418l-2.925-9.518-1.232-4.541q.139 2.809.139 3.717v10.342h-3.017V22.313h4.548l2.902 9.543.253.92.553 2.289.725-2.736 2.983-10.015h4.526v17.063zm17.64.0-1.44-4.359h-6.184l-1.44 4.359h-3.397l5.919-17.063h4.007l5.896 17.063zm-4.537-14.434-.069.267q-.115.436-.277.993c-.162.557-.767 2.414-1.98 6.128h4.663l-1.601-4.905-.495-1.647zm24.577 5.776q0 2.64-.99 4.614-.979 1.961-2.787 3.003-1.796 1.042-4.122 1.042h-6.564V22.313h5.873q4.099.0 6.345 2.18 2.245 2.167 2.245 6.224m-3.42.0q0-2.748-1.359-4.19-1.359-1.453-3.881-1.453h-2.407v11.54h2.879q2.188.0 3.478-1.586t1.29-4.311m6 8.659V22.313h12.759v2.761h-9.362v4.287h8.66v2.761h-8.66v4.492h9.835v2.761zm15.75.0v-3.693h3.328v3.693zm12.445-12.149q2.082.0 3.662.781 1.58.78 2.422 2.235.833 1.454.833 3.393.0 2.98-1.845 4.676Q124.302 40 121.085 40q-3.208.0-5.005-1.688-1.798-1.688-1.798-4.695c0-3.007.606-3.57 1.817-4.694q1.817-1.696 4.986-1.696m0 2.702q-2.157.0-3.378.97-1.23.97-1.23 2.72.0 1.777 1.22 2.747 1.211.97 3.388.97 2.195.0 3.462-.988 1.258-.997 1.258-2.711.0-1.778-1.23-2.738-1.23-.97-3.491-.97m6.725-13.402-5.062 2.935v3.107h5.062v2.648h-13.331v-6.322q0-2.261 1.031-3.491 1.022-1.23 2.942-1.23 1.4.0 2.422.754 1.012.754 1.334 2.038l5.601-3.42zm-9.244.314q-1.92.0-1.921 2.334v3.393h3.936v-3.465q0-1.113-.53-1.688t-1.486-.575m7.249-10.915a6.5 6.5.0 00-.313-2.002q-.321-.969-.814-1.499h-1.845v3.088h-2.063V0h4.901q1.088 1.005 1.703 2.622a9.4 9.4.0 01.615 3.375q0 3.088-1.798 4.748-1.808 1.661-5.119 1.661-3.292.0-5.043-1.67-1.76-1.67-1.76-4.803.0-4.452 3.473-5.664l.776 2.442q-1.012.395-1.533 1.238-.52.844-.52 1.984.0 1.867 1.192 2.837t3.416.97q2.261.0 3.501-.997 1.23-1.005 1.23-2.818z"/></svg></abbr></a></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2026 <a href=https://chiehting.com/>Chiehting's Blog</a>
&#183; Copyright © 2025 Chiehting Lee. All rights reserved.</p></footer><script async src=https://chiehting.com/js/bundle.min.217d62397cbef6f9f5d8bab30d7e7969d78c52a436ca5d5790cef4d6fef3f1f2.js integrity="sha256-IX1iOXy+9vn12LqzDX55adeMUqQ2yl1XkM701v7z8fI=" crossorigin=anonymous></script><script async src=https://chiehting.com/js/link-share.min.24409a4f6e5537d70ffc55ec8f9192208d718678cb8638585342423020b37f39.js integrity="sha256-JECaT25VN9cP/FXsj5GSII1xhnjLhjhYU0JCMCCzfzk=" crossorigin=anonymous></script></body></html>