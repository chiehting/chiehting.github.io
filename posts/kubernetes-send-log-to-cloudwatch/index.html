<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-G1C48BPHVP"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-G1C48BPHVP")}</script><meta charset=UTF-8><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimal-ui"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=robots content="index, follow"><meta name=author content><meta name=description content="This website is preview about Chiehting. irregular update."><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><meta name=apple-mobile-web-app-title content="Chiehting's Blog"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="How to send log from AWS eks to cloudwatch."><meta itemprop=description content="研究如何使用 AWS 的 CloudWatch 來收集 EKS 的 log. 並使用 Grafana 做 log search.
原本的 logging architecture 是使用 Elasticsearch + Filebeat + Kibana; 現在改用 AWS CloudWatch + Fluent Bit + Grafana."><meta itemprop=datePublished content="2022-11-24T10:00:00+08:00"><meta itemprop=dateModified content="2022-11-24T10:00:00+08:00"><meta itemprop=wordCount content="1082"><meta itemprop=keywords content="Kubernetes,Log,Cloudwatch"><meta property="og:url" content="https://chiehting.com/posts/kubernetes-send-log-to-cloudwatch/"><meta property="og:site_name" content="Chiehting's Blog"><meta property="og:title" content="How to send log from AWS eks to cloudwatch."><meta property="og:description" content="研究如何使用 AWS 的 CloudWatch 來收集 EKS 的 log. 並使用 Grafana 做 log search.
原本的 logging architecture 是使用 Elasticsearch + Filebeat + Kibana; 現在改用 AWS CloudWatch + Fluent Bit + Grafana."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-24T10:00:00+08:00"><meta property="article:modified_time" content="2022-11-24T10:00:00+08:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Log"><meta property="article:tag" content="Cloudwatch"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to send log from AWS eks to cloudwatch."><meta name=twitter:description content="研究如何使用 AWS 的 CloudWatch 來收集 EKS 的 log. 並使用 Grafana 做 log search.
原本的 logging architecture 是使用 Elasticsearch + Filebeat + Kibana; 現在改用 AWS CloudWatch + Fluent Bit + Grafana."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to send log from AWS eks to cloudwatch.","name":"How to send log from AWS eks to cloudwatch.","description":"研究如何使用 AWS 的 CloudWatch 來收集 EKS 的 log. 並使用 Grafana 做 log search.\n原本的 logging architecture 是使用 Elasticsearch + Filebeat + Kibana; 現在改用 AWS CloudWatch + Fluent Bit + Grafana.\n","keywords":["kubernetes","log","cloudwatch"],"articleBody":"研究如何使用 AWS 的 CloudWatch 來收集 EKS 的 log. 並使用 Grafana 做 log search.\n原本的 logging architecture 是使用 Elasticsearch + Filebeat + Kibana; 現在改用 AWS CloudWatch + Fluent Bit + Grafana.\n問題描述 原架構為 Elasticsearch + Filebeat + Kibana, 基於下述狀況決定改架構, 來減少維護成本.\n目前開發使用情境, 之需要查看 log 且可以搜尋, 不需要做資料探勘. 殺雞用牛刀了. Elasticsearch 在 Basic License 下, 無法使用 LDAP, PKI3, Active Directory authentication 功能. Elasticsearch 硬體需求較高, 最低的硬體需求為 t2.large (2 vCPU, 8 Mem). Elasticsearch 使用門檻較高, 能維護的人員不多, 維護上困難. 日誌蒐集狀況 Index lifecycle Management 配置 取 kubernetes 的 ilm 配置, 看到熱資料配置為 20gb or 15d 做 rollover.\nelasticsearch:/opt$ curl -XGET --user \"$account:$password\" \"http://$host/_ilm/policy/kubernetes?pretty\"|jq { \"kubernetes\" : { \"version\" : 23, \"modified_date\" : \"2021-07-07T07:58:49.033Z\", \"policy\" : { \"phases\" : { .................. \"hot\" : { \"min_age\" : \"0ms\", \"actions\" : { \"rollover\" : { \"max_primary_shard_size\" : \"20gb\", \"max_age\" : \"15d\" }, \"forcemerge\" : { \"max_num_segments\" : 1 }, \"readonly\" : { }, \"shrink\" : { \"number_of_shards\" : 1 }, \"set_priority\" : { \"priority\" : 100 } } }, } }, .................. } } 資料使用量 目前資料使用量為 167G (./elasticsearch/data).\n取其中一個 site 的 production 環境資料,平均 index 約 9.62 GB.\ncurl -XGET --user \"$account:$password\" \"http://$host/_cat/indices/*prod*?v=true\u0026pretty\u0026s=index\" health status index uuid pri rep docs.count docs.deleted store.size pri.store.size green open kubernetes-prod-000039 co5bX1YqSOu11BaKVkUnKw 2 0 10075181 0 6.5gb 6.5gb green open shrink-arvp-kubernetes-prod-000036 tgcGQwEZSliq9H2R4QJDCQ 1 0 16602612 0 10gb 10gb green open shrink-kvlp-kubernetes-prod-000038 g0if66MHTDmyWm4vcuX9cw 1 0 15674075 0 9.7gb 9.7gb green open shrink-laqk-kubernetes-prod-000035 FxLNQzpjQRKjsz_H8Vkl5w 1 0 20661224 0 12.7gb 12.7gb green open shrink-ttkl-kubernetes-prod-000037 DpeVcQVgTg-VKfOykWkN3Q 1 0 15092948 0 9.2gb 9.2gb 執行 照著 AWS 教學文件 Set up Fluent Bit as a DaemonSet to send logs to CloudWatch Logs 實作.\nCreate AWS CloudWatch Logs 首先需要建立 AWS CloudWatch 的 Log groups for log stream. 其中 Cluster_Name 為 EKS cluster 名稱.\n/aws/containerinsights/Cluster_Name/application /aws/containerinsights/Cluster_Name/host /aws/containerinsights/Cluster_Name/dataplane 在這邊使用 Terraform aws_cloudwatch_log_group 來實作.\nQuick Start setup for Container Insights on Amazon EKS and Kubernetes 配置 IAM 權限. EKS 的 Node IAM role 需含下面權限 data \"aws_iam_policy_document\" \"eks_node_group_cloudwatch_role\" { statement { actions = [ \"logs:CreateLogStream\", \"logs:CreateLogGroup\", \"logs:DescribeLogStreams\", \"logs:PutLogEvents\" ] effect = \"Allow\" resources = [ \"*\", ] } } 接著按照文件 Quick Start setup for Container Insights on Amazon EKS and Kubernetes 安裝 DaemonSet of Fluent Bit.\n建立 kubernetes namespace kubectl apply -f https://raw.githubusercontent.com/aws-samples/amazon-cloudwatch-container-insights/latest/k8s-deployment-manifest-templates/deployment-mode/daemonset/container-insights-monitoring/cloudwatch-namespace.yaml 執行 fluent-bit.yaml ClusterName=production RegionName=us-east-1 FluentBitHttpPort='2020' FluentBitReadFromHead='Off' [[ ${FluentBitReadFromHead} = 'On' ]] \u0026\u0026 FluentBitReadFromTail='Off'|| FluentBitReadFromTail='On' [[ -z ${FluentBitHttpPort} ]] \u0026\u0026 FluentBitHttpServer='Off' || FluentBitHttpServer='On' curl https://raw.githubusercontent.com/aws-samples/amazon-cloudwatch-container-insights/latest/k8s-deployment-manifest-templates/deployment-mode/daemonset/container-insights-monitoring/quickstart/cwagent-fluent-bit-quickstart.yaml | sed 's/{{cluster_name}}/'${ClusterName}'/;s/{{region_name}}/'${RegionName}'/;s/{{http_server_toggle}}/\"'${FluentBitHttpServer}'\"/;s/{{http_server_port}}/\"'${FluentBitHttpPort}'\"/;s/{{read_from_head}}/\"'${FluentBitReadFromHead}'\"/;s/{{read_from_tail}}/\"'${FluentBitReadFromTail}'\"/' | kubectl apply -f - 調整 application-log.conf 由於有做 healthcheck, 所以在 log 希望可以過濾掉 healthcheck 的資料.\n需要再 application-log.conf 中加入下面資訊\n[FILTER] Name grep Match application.* Exclude log /.*healthcheck.*/ kubectl edit configmap/fluent-bit-config -n amazon-cloudwatch 使用 Grafana 做 Dashborad 帳戶管理 LDAP 上面提到痛點之一就是帳戶無法統一管理, 容易遺漏. 這邊 Grafana 原生就提供 LDAP 的功能.\n確認 LDAP 功能有 enable, 在 /usr/share/grafana/conf/defaults.ini. 這邊以 image: grafana/grafana:8.3.1 為例, 編輯 /usr/share/grafana/conf/ldap.toml 檔案.\n[[servers]] host = \"ldap.example.com\" port = 389 use_ssl = false start_tls = false ssl_skip_verify = false bind_dn = \"uid=uid,cn=users,cn=accounts,dc=example,dc=com\" bind_password = 'passowrd' search_filter = \"(uid=%s)\" search_base_dns = [\"cn=users,cn=accounts,dc=example,dc=com\"] [servers.attributes] name = \"givenName\" surname = \"sn\" username = \"uid\" member_of = \"memberOf\" email = \"email\" [[servers.group_mappings]] group_dn = \"cn=admins,cn=groups,cn=accounts,dc=example,dc=com\" org_role = \"Admin\" [[servers.group_mappings]] group_dn = \"cn=groups,ou=accounts,dc=example,dc=com\" org_role = \"Editor\" [[servers.group_mappings]] group_dn = \"*\" org_role = \"Viewer\" Create Data Source 進到 Grafana 中的 Data Source, 加入 CloudWatch 源.\n完成效果 完成後會在 AWS CloudWatch 的 log groups 有接收到 log streams.\n在 Grafana 中建立 Dashboard.\n結論 上面提到的問題, 改了架構後做觀察.\n目前開發使用情境, 之需要查看 log 且可以搜尋, 不需要做 log 分析..\n這邊換了架構對開發並無影響. (開發沒過多反應, 平時有在使用嗎?)\nElasticsearch 在 Basic License 下, 無法使用 LDAP, PKI3, Active Directory authentication 功能.\n這邊改用 Grafana 的 LDAP 功能做改善, 帳密的管理統一, 維護上變簡單.\nElasticsearch 硬體需求較高, 為 t2.large (2 vCPU, 8 Mem).\n原本 t2.large, 使用 AWS 計算機算出的費用約 108.96 USD/Monthly cost 更改 CloudWatch, 收到的費用為 108.96 USD/Monthly cost (這邊為所有 groups 的費用, 包括 application, EKS, RDS 等)\n這邊比較尷尬, 由於兩邊收集的 log 量不同, 不容易比較.\nElasticsearch 能維護的人員不多, 維護上困難.\n在寫這篇文章的同時, 也看到一些新的 index 配置並無做優化. 相關配置也已經被動到. 很難受. 改新架構後維護應該要變簡單, 因為不用去搞 index 跟 ilm.\n","wordCount":"1082","inLanguage":"en","datePublished":"2022-11-24T10:00:00+08:00","dateModified":"2022-11-24T10:00:00+08:00","author":{"@type":"Person","name":null},"mainEntityOfPage":{"@type":"WebPage","@id":"https://chiehting.com/posts/kubernetes-send-log-to-cloudwatch/"},"publisher":{"@type":"Organization","name":"Chiehting's Blog","description":"This website is preview about Chiehting. irregular update.","logo":{"@type":"ImageObject","url":"https://chiehting.com/favicon.ico"}}}</script><title>How to send log from AWS eks to cloudwatch.</title><link rel="stylesheet dns-prefetch preconnect preload prefetch" as=style media=screen href=https://chiehting.com/css/style.min.4a728eca217aff37d24d94ea492de99e69fea0a53bb05c836db76b9d0504ef60.css integrity="sha256-SnKOyiF6/zfSTZTqSS3pnmn+oKU7sFyDbbdrnQUE72A=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://chiehting.com/>Chiehting's Blog</a></div><nav class="site-nav hide-in-mobile"><a href=https://chiehting.com/posts/>Posts</a><a href=https://chiehting.com/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-links hide-in-mobile"><a href=ting911111@gmail.com target=_blank rel="noopener me" title=Email><svg class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=https://github.com/chiehting target=_blank rel="noopener me" title=Github><svg class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://chiehting.com/posts/>Posts</a></li><li><a href=https://chiehting.com/about/>About</a></li></ul></div><main class="site-main section-inner thin animated fadeIn faster"><h1>How to send log from AWS eks to cloudwatch.</h1><div class=content><p>研究如何使用 AWS 的 CloudWatch 來收集 EKS 的 log. 並使用 Grafana 做 log search.</p><p>原本的 logging architecture 是使用 Elasticsearch + Filebeat + Kibana; 現在改用 AWS CloudWatch + Fluent Bit + Grafana.</p><h3 id=問題描述>問題描述<a href=#%e5%95%8f%e9%a1%8c%e6%8f%8f%e8%bf%b0 class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>原架構為 Elasticsearch + Filebeat + Kibana, 基於下述狀況決定改架構, 來減少維護成本.</p><ul><li>目前開發使用情境, 之需要查看 log 且可以搜尋, 不需要做資料探勘. 殺雞用牛刀了.</li><li>Elasticsearch 在 Basic License 下, 無法使用 LDAP, PKI3, Active Directory authentication 功能.</li><li>Elasticsearch <a href=https://www.elastic.co/guide/en/cloud-enterprise/current/ece-hardware-prereq.html>硬體需求</a>較高, 最低的硬體需求為 t2.large (2 vCPU, 8 Mem).</li><li>Elasticsearch 使用門檻較高, 能維護的人員不多, 維護上困難.</li></ul><h3 id=日誌蒐集狀況>日誌蒐集狀況<a href=#%e6%97%a5%e8%aa%8c%e8%92%90%e9%9b%86%e7%8b%80%e6%b3%81 class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><h4 id=index-lifecycle-management-配置>Index lifecycle Management 配置<a href=#index-lifecycle-management-%e9%85%8d%e7%bd%ae class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>取 kubernetes 的 ilm 配置, 看到熱資料配置為 20gb or 15d 做 rollover.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>elasticsearch:/opt$ curl -XGET --user <span class=s2>&#34;</span><span class=nv>$account</span><span class=s2>:</span><span class=nv>$password</span><span class=s2>&#34;</span>  <span class=s2>&#34;http://</span><span class=nv>$host</span><span class=s2>/_ilm/policy/kubernetes?pretty&#34;</span><span class=p>|</span>jq
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;kubernetes&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;version&#34;</span> : 23,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;modified_date&#34;</span> : <span class=s2>&#34;2021-07-07T07:58:49.033Z&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;policy&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;phases&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>        ..................
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hot&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;min_age&#34;</span> : <span class=s2>&#34;0ms&#34;</span>,
</span></span><span class=line><span class=cl>          <span class=s2>&#34;actions&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;rollover&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;max_primary_shard_size&#34;</span> : <span class=s2>&#34;20gb&#34;</span>,
</span></span><span class=line><span class=cl>              <span class=s2>&#34;max_age&#34;</span> : <span class=s2>&#34;15d&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;forcemerge&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;max_num_segments&#34;</span> : <span class=m>1</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;readonly&#34;</span> : <span class=o>{</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shrink&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;number_of_shards&#34;</span> : <span class=m>1</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;set_priority&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;priority&#34;</span> : <span class=m>100</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>          <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    ..................
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=資料使用量>資料使用量<a href=#%e8%b3%87%e6%96%99%e4%bd%bf%e7%94%a8%e9%87%8f class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>目前資料使用量為 167G (./elasticsearch/data).</p><p>取其中一個 site 的 production 環境資料,平均 index 約 9.62 GB.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -XGET --user <span class=s2>&#34;</span><span class=nv>$account</span><span class=s2>:</span><span class=nv>$password</span><span class=s2>&#34;</span>  <span class=s2>&#34;http://</span><span class=nv>$host</span><span class=s2>/_cat/indices/*prod*?v=true&amp;pretty&amp;s=index&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>health status index                                     uuid                   pri rep docs.count docs.deleted store.size pri.store.size
</span></span><span class=line><span class=cl>green  open   kubernetes-prod-000039             co5bX1YqSOu11BaKVkUnKw   <span class=m>2</span>   <span class=m>0</span>   <span class=m>10075181</span>            <span class=m>0</span>      6.5gb          6.5gb
</span></span><span class=line><span class=cl>green  open   shrink-arvp-kubernetes-prod-000036 tgcGQwEZSliq9H2R4QJDCQ   <span class=m>1</span>   <span class=m>0</span>   <span class=m>16602612</span>            <span class=m>0</span>       10gb           10gb
</span></span><span class=line><span class=cl>green  open   shrink-kvlp-kubernetes-prod-000038 g0if66MHTDmyWm4vcuX9cw   <span class=m>1</span>   <span class=m>0</span>   <span class=m>15674075</span>            <span class=m>0</span>      9.7gb          9.7gb
</span></span><span class=line><span class=cl>green  open   shrink-laqk-kubernetes-prod-000035 FxLNQzpjQRKjsz_H8Vkl5w   <span class=m>1</span>   <span class=m>0</span>   <span class=m>20661224</span>            <span class=m>0</span>     12.7gb         12.7gb
</span></span><span class=line><span class=cl>green  open   shrink-ttkl-kubernetes-prod-000037 DpeVcQVgTg-VKfOykWkN3Q   <span class=m>1</span>   <span class=m>0</span>   <span class=m>15092948</span>            <span class=m>0</span>      9.2gb          9.2gb
</span></span></code></pre></div><h3 id=執行>執行<a href=#%e5%9f%b7%e8%a1%8c class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>照著 AWS 教學文件 <a href=https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Container-Insights-setup-logs-FluentBit.html>Set up Fluent Bit as a DaemonSet to send logs to CloudWatch Logs</a> 實作.</p><h4 id=create-aws-cloudwatch-logs>Create AWS CloudWatch Logs<a href=#create-aws-cloudwatch-logs class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>首先需要建立 AWS CloudWatch 的 Log groups for log stream. 其中 <code>Cluster_Name</code> 為 EKS cluster 名稱.</p><ul><li>/aws/containerinsights/<code>Cluster_Name</code>/application</li><li>/aws/containerinsights/<code>Cluster_Name</code>/host</li><li>/aws/containerinsights/<code>Cluster_Name</code>/dataplane</li></ul><p>在這邊使用 Terraform <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group>aws_cloudwatch_log_group</a> 來實作.</p><h4 id=quick-start-setup-for-container-insights-on-amazon-eks-and-kubernetes>Quick Start setup for Container Insights on Amazon EKS and Kubernetes<a href=#quick-start-setup-for-container-insights-on-amazon-eks-and-kubernetes class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><h5 id=配置-iam-權限-eks-的-node-iam-role-需含下面權限>配置 IAM 權限. EKS 的 Node IAM role 需含下面權限<a href=#%e9%85%8d%e7%bd%ae-iam-%e6%ac%8a%e9%99%90-eks-%e7%9a%84-node-iam-role-%e9%9c%80%e5%90%ab%e4%b8%8b%e9%9d%a2%e6%ac%8a%e9%99%90 class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=kr>data</span> <span class=s2>&#34;aws_iam_policy_document&#34;</span> <span class=s2>&#34;eks_node_group_cloudwatch_role&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>statement</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>actions</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;logs:CreateLogStream&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;logs:CreateLogGroup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;logs:DescribeLogStreams&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;logs:PutLogEvents&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>effect</span> <span class=o>=</span> <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>resources</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>接著按照文件 <a href=https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Container-Insights-setup-EKS-quickstart.html>Quick Start setup for Container Insights on Amazon EKS and Kubernetes</a> 安裝 DaemonSet of Fluent Bit.</p><h5 id=建立-kubernetes-namespace>建立 kubernetes namespace<a href=#%e5%bb%ba%e7%ab%8b-kubernetes-namespace class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f https://raw.githubusercontent.com/aws-samples/amazon-cloudwatch-container-insights/latest/k8s-deployment-manifest-templates/deployment-mode/daemonset/container-insights-monitoring/cloudwatch-namespace.yaml
</span></span></code></pre></div><h5 id=執行-fluent-bityaml>執行 fluent-bit.yaml<a href=#%e5%9f%b7%e8%a1%8c-fluent-bityaml class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ClusterName</span><span class=o>=</span>production
</span></span><span class=line><span class=cl><span class=nv>RegionName</span><span class=o>=</span>us-east-1
</span></span><span class=line><span class=cl><span class=nv>FluentBitHttpPort</span><span class=o>=</span><span class=s1>&#39;2020&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>FluentBitReadFromHead</span><span class=o>=</span><span class=s1>&#39;Off&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[[</span> <span class=si>${</span><span class=nv>FluentBitReadFromHead</span><span class=si>}</span> <span class=o>=</span> <span class=s1>&#39;On&#39;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>FluentBitReadFromTail</span><span class=o>=</span><span class=s1>&#39;Off&#39;</span><span class=o>||</span> <span class=nv>FluentBitReadFromTail</span><span class=o>=</span><span class=s1>&#39;On&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[[</span> -z <span class=si>${</span><span class=nv>FluentBitHttpPort</span><span class=si>}</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>FluentBitHttpServer</span><span class=o>=</span><span class=s1>&#39;Off&#39;</span> <span class=o>||</span> <span class=nv>FluentBitHttpServer</span><span class=o>=</span><span class=s1>&#39;On&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl https://raw.githubusercontent.com/aws-samples/amazon-cloudwatch-container-insights/latest/k8s-deployment-manifest-templates/deployment-mode/daemonset/container-insights-monitoring/quickstart/cwagent-fluent-bit-quickstart.yaml <span class=p>|</span> sed <span class=s1>&#39;s/{{cluster_name}}/&#39;</span><span class=si>${</span><span class=nv>ClusterName</span><span class=si>}</span><span class=s1>&#39;/;s/{{region_name}}/&#39;</span><span class=si>${</span><span class=nv>RegionName</span><span class=si>}</span><span class=s1>&#39;/;s/{{http_server_toggle}}/&#34;&#39;</span><span class=si>${</span><span class=nv>FluentBitHttpServer</span><span class=si>}</span><span class=s1>&#39;&#34;/;s/{{http_server_port}}/&#34;&#39;</span><span class=si>${</span><span class=nv>FluentBitHttpPort</span><span class=si>}</span><span class=s1>&#39;&#34;/;s/{{read_from_head}}/&#34;&#39;</span><span class=si>${</span><span class=nv>FluentBitReadFromHead</span><span class=si>}</span><span class=s1>&#39;&#34;/;s/{{read_from_tail}}/&#34;&#39;</span><span class=si>${</span><span class=nv>FluentBitReadFromTail</span><span class=si>}</span><span class=s1>&#39;&#34;/&#39;</span> <span class=p>|</span> kubectl apply -f - 
</span></span></code></pre></div><h5 id=調整-application-logconf>調整 application-log.conf<a href=#%e8%aa%bf%e6%95%b4-application-logconf class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h5><p>由於有做 healthcheck, 所以在 log 希望可以過濾掉 healthcheck 的資料.</p><p>需要再 application-log.conf 中加入下面資訊</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[FILTER]
</span></span><span class=line><span class=cl>    Name                grep
</span></span><span class=line><span class=cl>    Match               application.*
</span></span><span class=line><span class=cl>    Exclude             log /.*healthcheck.*/
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl edit configmap/fluent-bit-config -n amazon-cloudwatch
</span></span></code></pre></div><h4 id=使用-grafana-做-dashborad>使用 Grafana 做 Dashborad<a href=#%e4%bd%bf%e7%94%a8-grafana-%e5%81%9a-dashborad class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><h5 id=帳戶管理-ldap>帳戶管理 LDAP<a href=#%e5%b8%b3%e6%88%b6%e7%ae%a1%e7%90%86-ldap class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h5><p>上面提到痛點之一就是帳戶無法統一管理, 容易遺漏. 這邊 Grafana 原生就提供 LDAP 的功能.</p><p>確認 LDAP 功能有 enable, 在 <code>/usr/share/grafana/conf/defaults.ini</code>.
這邊以 <code>image: grafana/grafana:8.3.1</code> 為例, 編輯 <code>/usr/share/grafana/conf/ldap.toml</code> 檔案.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[[</span><span class=nx>servers</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nx>host</span> <span class=p>=</span> <span class=s2>&#34;ldap.example.com&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>port</span> <span class=p>=</span> <span class=mi>389</span>
</span></span><span class=line><span class=cl><span class=nx>use_ssl</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=nx>start_tls</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=nx>ssl_skip_verify</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=nx>bind_dn</span> <span class=p>=</span> <span class=s2>&#34;uid=uid,cn=users,cn=accounts,dc=example,dc=com&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>bind_password</span> <span class=p>=</span> <span class=s1>&#39;passowrd&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>search_filter</span> <span class=p>=</span> <span class=s2>&#34;(uid=%s)&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>search_base_dns</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;cn=users,cn=accounts,dc=example,dc=com&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>servers</span><span class=p>.</span><span class=nx>attributes</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;givenName&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>surname</span> <span class=p>=</span> <span class=s2>&#34;sn&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>username</span> <span class=p>=</span> <span class=s2>&#34;uid&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>member_of</span> <span class=p>=</span> <span class=s2>&#34;memberOf&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>email</span> <span class=p>=</span>  <span class=s2>&#34;email&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>servers</span><span class=p>.</span><span class=nx>group_mappings</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nx>group_dn</span> <span class=p>=</span> <span class=s2>&#34;cn=admins,cn=groups,cn=accounts,dc=example,dc=com&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>org_role</span> <span class=p>=</span> <span class=s2>&#34;Admin&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>servers</span><span class=p>.</span><span class=nx>group_mappings</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nx>group_dn</span> <span class=p>=</span> <span class=s2>&#34;cn=groups,ou=accounts,dc=example,dc=com&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>org_role</span> <span class=p>=</span> <span class=s2>&#34;Editor&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>servers</span><span class=p>.</span><span class=nx>group_mappings</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nx>group_dn</span> <span class=p>=</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>org_role</span> <span class=p>=</span> <span class=s2>&#34;Viewer&#34;</span>
</span></span></code></pre></div><h4 id=create-data-source>Create Data Source<a href=#create-data-source class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>進到 Grafana 中的 Data Source, 加入 CloudWatch 源.</p><h3 id=完成效果>完成效果<a href=#%e5%ae%8c%e6%88%90%e6%95%88%e6%9e%9c class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>完成後會在 AWS CloudWatch 的 log groups 有接收到 log streams.</p><p><img src=https://storage.googleapis.com/chiehting.com/blog/2022-11-24-how-to-send-eks-log-to-cloudwatch-1.png alt="AWS CloudWatch Logs Insights"></p><p>在 Grafana 中建立 Dashboard.</p><p><img src=https://storage.googleapis.com/chiehting.com/blog/2022-11-24-how-to-send-eks-log-to-cloudwatch-2.png alt="Grafana Dashboard"></p><h4 id=結論>結論<a href=#%e7%b5%90%e8%ab%96 class=anchor aria-hidden=true><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>上面提到的問題, 改了架構後做觀察.</p><blockquote><p>目前開發使用情境, 之需要查看 log 且可以搜尋, 不需要做 log 分析..</p></blockquote><p>這邊換了架構對開發並無影響. (開發沒過多反應, 平時有在使用嗎?)</p><blockquote><p>Elasticsearch 在 Basic License 下, 無法使用 LDAP, PKI3, Active Directory authentication 功能.</p></blockquote><p>這邊改用 Grafana 的 LDAP 功能做改善, 帳密的管理統一, 維護上變簡單.</p><blockquote><p>Elasticsearch 硬體需求較高, 為 t2.large (2 vCPU, 8 Mem).</p></blockquote><p>原本 t2.large, 使用 AWS 計算機算出的費用約 108.96 USD/Monthly cost
更改 CloudWatch, 收到的費用為 108.96 USD/Monthly cost (這邊為所有 groups 的費用, 包括 application, EKS, RDS 等)</p><p>這邊比較尷尬, 由於兩邊收集的 log 量不同, 不容易比較.</p><blockquote><p>Elasticsearch 能維護的人員不多, 維護上困難.</p></blockquote><p>在寫這篇文章的同時, 也看到一些新的 index 配置並無做優化. 相關配置也已經被動到. 很難受.
改新架構後維護應該要變簡單, 因為不用去搞 index 跟 ilm.</p></div><div class="human single"><a href=https://brainmade.org/ target=_blank rel="external noreferrer noopener"><abbr title="I don't hate AIs; but I love humans!"><svg fill="#fff" width="128" height="40" viewBox="0 0 128 40"><path d="M26.306 39.391H11.665a1.28 1.28.0 01-1.28-1.28v-3.838H6.399a1.28 1.28.0 01-1.28-1.28v-5.336l-4.41-2.198a1.28 1.28.0 01-.493-1.855l4.904-7.357v-2.175C5.12 6.298 11.422.0 19.194.0s14.073 6.3 14.075 14.071c-.316 13.912-5.38 11.758-5.59 17.023l-.093 7.018a1.3 1.3.0 01-.375.905 1.27 1.27.0 01-.905.375zm-13.361-2.559h12.082l.143-7.27c-.132-3.329 5.858-4.122 5.54-15.368-.179-6.356-5.157-11.635-11.515-11.635S7.68 7.713 7.679 14.071v2.559c-.001.253-.075.5-.215.71l-4.315 6.471 3.822 1.91a1.28 1.28.0 01.708 1.145v4.848h3.987a1.28 1.28.0 011.28 1.28z"/><path d="M20.186 29.111v-9.644c.059.0.118.009.177.009 4.885-.006 8.525-4.506 7.511-9.284a1.19 1.19.0 00-.911-.911 7.67 7.67.0 00-9.049 5.67l-.033-.036a7.66 7.66.0 00-7.03-2.085 1.19 1.19.0 00-.911.91c-1.014 4.777 2.627 9.277 7.51 9.284.118.0.246-.014.369-.02v6.106zm1.419-16.072a5.33 5.33.0 014.062-1.553 5.33 5.33.0 01-5.614 5.615 5.3 5.3.0 011.552-4.061zm-7.904 6.057a5.3 5.3.0 01-1.559-4.061 5.323 5.323.0 015.614 5.615 5.3 5.3.0 01-4.055-1.554m38.419-6.79q0 2.346-1.567 3.63-1.567 1.282-4.351 1.283h-7.669V0h7.016q2.807.0 4.242 1.1 1.446 1.087 1.446 3.226.0 1.467-.729 2.481-.718 1.002-2.197 1.357 1.86.244 2.828 1.32.979 1.063.979 2.823zm-4.112-7.491q0-1.161-.663-1.65-.652-.488-1.947-.488h-3.655v4.265h3.677q1.36.0 1.968-.525.62-.537.62-1.601m.892 7.209q0-2.42-3.089-2.42h-4.069v4.938h4.188q1.545.0 2.252-.624.718-.635.718-1.894m16.26 5.194-3.557-6.538h-3.764v6.538H54.63V0h7.658q2.741.0 4.231 1.332 1.49 1.32 1.49 3.8.0 1.808-.913 3.128-.914 1.308-2.47 1.723l4.144 7.235zm-.381-11.94q0-2.481-2.828-2.481h-4.112v5.083h4.199q1.349.0 2.045-.684.696-.685.696-1.919m16.785 11.94-1.36-4.399h-5.841l-1.359 4.399h-3.209L75.386.0h3.785l5.569 17.219zM77.278 2.651l-.066.269q-.109.44-.261 1.002c-.152.563-.725 2.436-1.871 6.184h4.405l-1.512-4.949-.468-1.662zm9.551 14.567V0h3.209v17.219zm15.53.0L95.681 3.959q.196 1.931.196 3.104v10.155h-2.849V0h3.666l6.777 13.37q-.196-1.846-.196-3.361V0h2.85v17.219zM52.63 39.375V28.331q.011-.351.115-3.015-.818 3.257-1.209 4.541l-2.925 9.518h-2.418l-2.925-9.518-1.232-4.541q.139 2.809.139 3.717v10.342h-3.017V22.313h4.548l2.902 9.543.253.92.553 2.289.725-2.736 2.983-10.015h4.526v17.063zm17.64.0-1.44-4.359h-6.184l-1.44 4.359h-3.397l5.919-17.063h4.007l5.896 17.063zm-4.537-14.434-.069.267q-.115.436-.277.993c-.162.557-.767 2.414-1.98 6.128h4.663l-1.601-4.905-.495-1.647zm24.577 5.776q0 2.64-.99 4.614-.979 1.961-2.787 3.003-1.796 1.042-4.122 1.042h-6.564V22.313h5.873q4.099.0 6.345 2.18 2.245 2.167 2.245 6.224m-3.42.0q0-2.748-1.359-4.19-1.359-1.453-3.881-1.453h-2.407v11.54h2.879q2.188.0 3.478-1.586t1.29-4.311m6 8.659V22.313h12.759v2.761h-9.362v4.287h8.66v2.761h-8.66v4.492h9.835v2.761zm15.75.0v-3.693h3.328v3.693zm12.445-12.149q2.082.0 3.662.781 1.58.78 2.422 2.235.833 1.454.833 3.393.0 2.98-1.845 4.676Q124.302 40 121.085 40q-3.208.0-5.005-1.688-1.798-1.688-1.798-4.695c0-3.007.606-3.57 1.817-4.694q1.817-1.696 4.986-1.696m0 2.702q-2.157.0-3.378.97-1.23.97-1.23 2.72.0 1.777 1.22 2.747 1.211.97 3.388.97 2.195.0 3.462-.988 1.258-.997 1.258-2.711.0-1.778-1.23-2.738-1.23-.97-3.491-.97m6.725-13.402-5.062 2.935v3.107h5.062v2.648h-13.331v-6.322q0-2.261 1.031-3.491 1.022-1.23 2.942-1.23 1.4.0 2.422.754 1.012.754 1.334 2.038l5.601-3.42zm-9.244.314q-1.92.0-1.921 2.334v3.393h3.936v-3.465q0-1.113-.53-1.688t-1.486-.575m7.249-10.915a6.5 6.5.0 00-.313-2.002q-.321-.969-.814-1.499h-1.845v3.088h-2.063V0h4.901q1.088 1.005 1.703 2.622a9.4 9.4.0 01.615 3.375q0 3.088-1.798 4.748-1.808 1.661-5.119 1.661-3.292.0-5.043-1.67-1.76-1.67-1.76-4.803.0-4.452 3.473-5.664l.776 2.442q-1.012.395-1.533 1.238-.52.844-.52 1.984.0 1.867 1.192 2.837t3.416.97q2.261.0 3.501-.997 1.23-1.005 1.23-2.818z"/></svg></abbr></a></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2026 <a href=https://chiehting.com/>Chiehting's Blog</a>
&#183; Copyright © 2025 Chiehting Lee. All rights reserved.</p></footer><script async src=https://chiehting.com/js/bundle.min.217d62397cbef6f9f5d8bab30d7e7969d78c52a436ca5d5790cef4d6fef3f1f2.js integrity="sha256-IX1iOXy+9vn12LqzDX55adeMUqQ2yl1XkM701v7z8fI=" crossorigin=anonymous></script><script async src=https://chiehting.com/js/link-share.min.24409a4f6e5537d70ffc55ec8f9192208d718678cb8638585342423020b37f39.js integrity="sha256-JECaT25VN9cP/FXsj5GSII1xhnjLhjhYU0JCMCCzfzk=" crossorigin=anonymous></script></body></html>